---
title: "Data Science Homework 5"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(httr)
```

### Problem 1

```{r importing and tidying data, message = FALSE}
file_names <- list.files("./data/", full.names = TRUE)

df <- file_names %>% 
  map(read_csv)

for (i in 1:20) {
  if (i < 11) {
    df[[i]] <- df[[i]] %>% 
    mutate(arm = "control", 
           study_id = i)
  } else if (i > 10) {
    df[[i]] <- df[[i]] %>% 
      mutate(arm = "experimental", 
             study_id = i - 10)
  }
}

df <- bind_rows(df) %>% 
  gather(key = week, value = obs, week_1:week_8) %>% 
  arrange(week, study_id) %>% 
  separate(col = week, into = c("delete", "week")) %>% 
  select(-delete)
```

```{r spaghetti plot, fig.align = "center", out.width = "75%", dpi = 300}
df %>% 
  mutate(week = as.double(week), 
         study_id = as.character(study_id)) %>% 
  group_by(arm, study_id) %>% 
  ggplot(aes(x = week, y = obs, color = arm, type = study_id)) + 
    geom_line() + 
  theme_bw() + 
  labs(title = "Trend in observations across weeks for each\n participant stratified by study arm",
       x = "Week", 
       y = "Observation") + 
  viridis::scale_color_viridis(name = "Study arm",
                               discrete = TRUE) + 
  theme(legend.position = "bottom", 
        legend.direction = "horizontal", 
        legend.box.spacing = unit(0.05, "cm"),
        plot.title = element_text(size = 13))
```


### Problem 2

